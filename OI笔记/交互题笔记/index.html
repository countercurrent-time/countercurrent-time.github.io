<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"countercurrent-time.gitee.io","root":"/","scheme":"Muse","version":"8.0.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>

  <meta name="description" content="交互题是一类目前比较冷门，但是非常考验算法思维、程序设计与细节处理能力的题目。部分题目也会使用交互题形式要求强制在线。">
<meta property="og:type" content="article">
<meta property="og:title" content="交互题笔记">
<meta property="og:url" content="https://countercurrent-time.gitee.io/OI%E7%AC%94%E8%AE%B0/%E4%BA%A4%E4%BA%92%E9%A2%98%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name">
<meta property="og:description" content="交互题是一类目前比较冷门，但是非常考验算法思维、程序设计与细节处理能力的题目。部分题目也会使用交互题形式要求强制在线。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-04-14T09:20:17.000Z">
<meta property="article:modified_time" content="2020-10-01T11:12:03.291Z">
<meta property="article:author" content="逆流之时">
<meta property="article:tag" content="算法思想">
<meta property="article:tag" content="交互题">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://countercurrent-time.gitee.io/OI%E7%AC%94%E8%AE%B0/%E4%BA%A4%E4%BA%92%E9%A2%98%E7%AC%94%E8%AE%B0/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>交互题笔记 | </title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title"></h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#CF679A-Bear-and-Prime-100"><span class="nav-number">1.</span> <span class="nav-text">CF679A Bear and Prime 100</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CF727C-Guess-the-Array"><span class="nav-number">2.</span> <span class="nav-text">CF727C Guess the Array</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CF896B-Ithea-Plays-With-Chtholly"><span class="nav-number">3.</span> <span class="nav-text">CF896B Ithea Plays With Chtholly</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CF730B-Minimum-and-Maximum"><span class="nav-number">4.</span> <span class="nav-text">CF730B Minimum and Maximum</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CF843B-Interactive-LowerBound"><span class="nav-number">5.</span> <span class="nav-text">CF843B Interactive LowerBound</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UOJ206-APIO2016-Gap"><span class="nav-number">6.</span> <span class="nav-text">UOJ206 [APIO2016]Gap</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CF1088D-Ehab-and-another-another-xor-problem"><span class="nav-number">7.</span> <span class="nav-text">CF1088D Ehab and another another xor problem</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CF750F-New-Year-and-Finding-Roots"><span class="nav-number">8.</span> <span class="nav-text">CF750F New Year and Finding Roots</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UVA12731-%E5%A4%AA%E7%A9%BA%E7%AB%99%E4%B9%8B%E8%B0%9C-Mysterious-Space-Station"><span class="nav-number">9.</span> <span class="nav-text">UVA12731 太空站之谜 Mysterious Space Station</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%A0%E9%A2%98"><span class="nav-number">9.1.</span> <span class="nav-text">习题</span></a></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <a href = "/" class="site-author-name" itemprop="name">逆流之时</a>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="/404/" title="&#x2F;404&#x2F;">导航</a>
        </li>
    </ul>
  </div>

      </section>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://countercurrent-time.gitee.io/OI%E7%AC%94%E8%AE%B0/%E4%BA%A4%E4%BA%92%E9%A2%98%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="逆流之时">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="">
    </span>

    
    
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          交互题笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-14 17:20:17" itemprop="dateCreated datePublished" datetime="2020-04-14T17:20:17+08:00">2020-04-14</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-10-01 19:12:03" itemprop="dateModified" datetime="2020-10-01T19:12:03+08:00">2020-10-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OI%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">OI笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>交互题是一类目前比较冷门，但是非常考验算法思维、程序设计与细节处理能力的题目。部分题目也会使用交互题形式要求强制在线。</p>
<a id="more"></a>

<p>上个世纪的 IOI 就已涉及交互题。虽然交互题近年来没有在省选以下的比赛中出现，不过 2019 年里 NOI 系列比赛中连续出现《P5208 [WC2019] I 君的商店》、《P5473 [NOI2019]I 君的探险》两道交互题，这可能代表着交互题重新回到 NOI 系列比赛中。刘汝佳在 2002 年的 NOI 冬令营中的交互题目 《UVA12731 太空站之谜 Mysterious Space Station》，现场的选手最好的成绩也仅解决了 10 个测试点中的两个，并且至今 UVA 上仍未有人通过，只有 UOJ 上有除标程外另一份可以通过题目的代码，对算法思维和程序实现能力要求极高。</p>
<p>交互题没有很高的前置算法要求，一般也没有严格的时间限制，程序的优秀程度往往仅取决于交互次数限制。所以学习交互题时，建议按照难度循序渐进。要是有意锻炼算法思维而不只是单纯地学习算法，那么完成交互题是很不错的方法。虽然交互题对选手已掌握算法的要求通常较低，但仍建议掌握一定提高和省选算法后再尝试做交互题，因为此时自己的算法思维水平和知识面已经达到了一定水平。基础的交互题介绍可以参考<a href="../intro/non-trad.md">非传统题</a>。</p>
<p>因为交互题要求选手程序及时做出回答，所以需要 C++ 选手使用 <code>std::cout &lt;&lt; std::endl;</code>（换行时自动清空缓冲区），<code>std::cout &lt;&lt; std::flush;</code>（流输出）或者 <code>fflush(stdout)</code>（标准输出）刷新输出缓冲区。目前洛谷的 RemoteJudge 不支持爬取这类错误。</p>
<p>交互题的特殊错误：</p>
<ul>
<li>选手每一次输出后都需要刷新缓冲区，否则会引起 Idleness limit exceeded 错误。另外，如果题目含多组数据并且程序可以在未读入所有数据前就知道答案，也仍然要读入所有数据，否则同样会因为读入混乱引起 ILE（可以一次提出多次询问，一次接收所有询问的回答）。同时尽量不要使用快读。</li>
<li>如果程序查询次数过多，则在 Codeforces 上会给出 Wrong Answer 的评测结果（不过评测系统会说明 Wrong Answer 的原因），而 UVA 会给出 Protocol Limit Exceeded (PLE) 的评测结果。</li>
<li>如果程序交互格式错误，UVa 会给出 Protocol Violation (PV) 的评测结果。</li>
</ul>
<p>由于交互题输入输出较为繁琐，所以建议分别封装输入和输出函数。这一篇博客的代码中，直到《CF750F New Year and Finding Roots》才有具体范例。</p>
<p>比赛时如果出题人给出了 grader 头文件（用于 grader 交互题的调试）或者 checker 程序（用于 stdio 交互题的调试），则交互题的调试比较简单，因为交互题的对拍会比普通题目的对拍困难很多。没有 <code>testlib.h</code> 的情况下。交互细节较多的题目的 stdio 交互库会一般有 3k 代码量，再加上 3k 长度的对拍器，至少需要一小时实现。但是，无论是否有调试程序，调试交互题的代码都往往需要选手模拟与程序的交互过程，因此交互题需要选手能设计出高质量的程序，尽量保证一遍做对，同时拥有较强的静态查错能力。如果想实现 stdio 交互题对拍器，可以看这篇博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/tsreaper/p/pipe-interactive.html">用 Linux 管道实现 online judge 的交互题功能</a>。</p>
<p>在 Linux 可以简单地使用下面的指令实现 IO 交互：<code>(./a &lt; /dev/fd/3 | ./b) 3&gt;&amp;1 | :</code>。</p>
<p>目前洛谷不支持交互题，而 Codeforces、LibreOJ 等题库均支持交互题。</p>
<p>upd 2020-04-17：刚做了几道交互题洛谷就支持了交互题。</p>
<p>由于交互题有以上的性质，所以学习交互题时，建议按照难度循序渐进。要是有意锻炼算法思维而不只是单纯地学习算法，那么完成交互题是很不错的方法。虽然交互题对选手已掌握算法的要求通常较低，但仍建议掌握一定省选算法后再尝试做交互题，因为此时自己的算法思维水平和知识面已经达到了一定水平。</p>
<p>例题：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF679A">CF679A Bear and Prime 100</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF727C">CF727C Guess the Array</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF730B">CF730B Minimum and Maximum</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF843B">CF843B Interactive LowerBound</a></li>
<li><a target="_blank" rel="noopener" href="http://uoj.ac/problem/206">UOJ206 [APIO2016]Gap</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF1088D">CF1088D Ehab and another another xor problem</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF750F">CF750F New Year and Finding Roots</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/UVA12731">UVA12731 太空站之谜 Mysterious Space Station</a></li>
</ul>
<h1 id="CF679A-Bear-and-Prime-100"><a href="#CF679A-Bear-and-Prime-100" class="headerlink" title="CF679A Bear and Prime 100"></a>CF679A Bear and Prime 100</h1><p>每个质数都有且只有两个因数，所以直接枚举因数。由于限制最多询问 20 次，并且对于较大的数（如 92）尝试分解质因数时发现需要最多枚举到 $\lfloor\frac{n}{2}\rfloor$ 的质数。所以我们先筛出 50 以内的质数，每次把所有这些数都询问一遍。</p>
<p>由于本题对拍比较容易，可以直接把值域内的数都尝试一遍。我们会发现程序无法有效处理质数的平方。所以我们要把 2,3,5,7 的平方 4,9,25,49 都放进去，总共 19 个数字，符合题意。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> prime[] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">49</span> &#125;;</span><br><span class="line"><span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : prime) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, res);</span><br><span class="line">        <span class="keyword">if</span> (res[<span class="number">0</span>] == <span class="string">&#x27;y&#x27;</span> &amp;&amp; ++cnt == <span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;composite&quot;</span>), <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;prime&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="CF727C-Guess-the-Array"><a href="#CF727C-Guess-the-Array" class="headerlink" title="CF727C Guess the Array"></a>CF727C Guess the Array</h1><p>允许询问 $n$ 对不同位置的数之和，要求回答 $n$ 个数的值。</p>
<p>即二元一次方程组。有多种构造方案。</p>
<p>例 1：询问 $a_1 + a_2$，$a_1 + a_3$，$a_2 + a_3$，$a_{i - 1} + a_i(4 \le i \le n)$。直接解前三个方程组，后面的直接一个个代。</p>
<p>例 2：询问 $a_i + a_{i + 1}(1 \le i &lt; n)$，然后考虑询问哪一组和最好解。考虑询问一组知道后会比较好解的和，也可以得到类似上面的解法的形式。不过要注意，如果此时询问 $a_1 + a_n$ 并不会很好解。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> n, x, y, z;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">5005</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;? 1 2\n? 1 3\n? 2 3\n&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;x, &amp;y, &amp;z);</span><br><span class="line">    a[<span class="number">1</span>] = (x + y - z) / <span class="number">2</span>, a[<span class="number">2</span>] = x - a[<span class="number">1</span>], a[<span class="number">3</span>] = y - a[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, i, i - <span class="number">1</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">        a[i] = x - a[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;!&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">printf</span>(<span class="string">&quot; %d&quot;</span>, a[i]);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="CF896B-Ithea-Plays-With-Chtholly"><a href="#CF896B-Ithea-Plays-With-Chtholly" class="headerlink" title="CF896B Ithea Plays With Chtholly"></a>CF896B Ithea Plays With Chtholly</h1><p>考虑到询问次数上界非常宽松，所以我们考虑求类似于最长上升子序列的方法：每次输入 $x$ 后从左到右遍历，找到第一个大于 $x$ 的数，将其替代掉，如果没有这样的数就可以直接插入到末尾。</p>
<p>不过这样的方法次数上界是 $nc$，需要一点优化。</p>
<p>我们考虑把序列均分为两份，如果 $x \le \frac{c}{2}$ 就在前一段序列找到 $x$ 的后继位置，写上或者覆盖成 $x$；否则再后一段序列找到 $x$ 的前驱位置。可以证明这样贪心的思想是正确的。此时询问上界即 $n \cdot \lceil\frac{c}{2}\rceil$。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1005</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, c;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;c);</span><br><span class="line">    <span class="keyword">while</span> (m--) &#123;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= c / <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">                <span class="keyword">if</span> (a[i] == <span class="number">0</span> || a[i] &gt; x) &#123;</span><br><span class="line">                    a[i] = x;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line">                    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">                <span class="keyword">if</span> (a[i] == <span class="number">0</span> || a[i] &lt; x) &#123;</span><br><span class="line">                    a[i] = x;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, i);</span><br><span class="line">                    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="CF730B-Minimum-and-Maximum"><a href="#CF730B-Minimum-and-Maximum" class="headerlink" title="CF730B Minimum and Maximum"></a>CF730B Minimum and Maximum</h1><p>本题为《算法导论》上经典的使用 $\lceil\frac{3n}{2}\rceil-2$ 次比较得到最小、最大数的算法。一般题目无法考察此类算法，但是利用交互题的形式可以很好地实现。</p>
<p>算法也很简单：先假设 $n$ 为偶数，比较前两个数，得到其中的较大较小值，然后将后面的所有数按照位置相邻的关系分成 $\frac{n - 2}{2}$ 份，每份里两两比较。最后每次将较大值与当前最大值比较，较小值与当前最小值比较。如果 $n$ 为奇数，单独分类讨论一下就好了。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> T, n;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T); T--; ) &#123;</span><br><span class="line">        <span class="keyword">int</span> minn, maxn;</span><br><span class="line">        <span class="keyword">char</span> op[<span class="number">3</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>) minn = maxn = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? 1 2\n&quot;</span>);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op);</span><br><span class="line">            <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;&lt;&#x27;</span>) minn = <span class="number">1</span>, maxn = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> minn = <span class="number">2</span>, maxn = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> + (n % <span class="number">2</span> == <span class="number">0</span>); i &lt;= n; i += <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> minnow, maxnow;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, i, i + <span class="number">1</span>);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op);</span><br><span class="line">            <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;&lt;&#x27;</span>) minnow = i, maxnow = i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> minnow = i + <span class="number">1</span>, maxnow = i;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, minnow, minn);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op);</span><br><span class="line">            <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;&lt;&#x27;</span>) minn = minnow;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, maxnow, maxn);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op);</span><br><span class="line">            <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;&gt;&#x27;</span>) maxn = maxnow;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;! %d %d\n&quot;</span>, minn, maxn);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="CF843B-Interactive-LowerBound"><a href="#CF843B-Interactive-LowerBound" class="headerlink" title="CF843B Interactive LowerBound"></a>CF843B Interactive LowerBound</h1><p>链表最多有 $5 \times 10 ^ 4$ 个元素，但我们只能询问 $1999$ 次，并且只能获取元素的后一个元素，所以普通的遍历整个链表的方法不可用。直接设法逼近目标元素的位置只有一种方法：随机撒点。</p>
<p>对于 $n &lt; 2000$ 的情况直接枚举，$n \ge 2000$ 时，我们直接撒 1000 个点，这时这些点之间的期望距离很小，我们可以直接从小于 $x$ 的最大值开始向后遍历，可以证明在到达下一个点之前我们就已得到答案。遍历的过程中一旦找到大于等于 $x$ 的元素，就可以直接推出。</p>
<p>虽然整体思路简单，但实际情况下，如果没有学习过模拟退火等非完美随机算法，思考起来很可能会困难一些。</p>
<p>同时由于 Codeforces 具有 hack 机制，很多人会刻意卡掉没有初始化随机种子的代码，所以在 <code>random_shuffle()</code> 函数前需要 <code>srand((size_t)new char)</code>，否则会 <code>WA #107</code>。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">50005</span>;</span><br><span class="line"><span class="keyword">int</span> n, start, x;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;start, &amp;x);</span><br><span class="line">    <span class="keyword">if</span> (n &lt; <span class="number">2000</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">2e9</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d\n&quot;</span>, i), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="keyword">int</span> val, next;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;val, &amp;next);</span><br><span class="line">            <span class="keyword">if</span> (val &gt;= x) ans = <span class="built_in">std</span>::min(ans, val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ans == <span class="number">2e9</span>) ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;! %d&quot;</span>, ans), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        srand((<span class="keyword">size_t</span>)<span class="keyword">new</span> <span class="keyword">char</span>);</span><br><span class="line">        <span class="keyword">int</span> p = start, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) a[i] = i;</span><br><span class="line">        <span class="built_in">std</span>::random_shuffle(a + <span class="number">1</span>, a + n + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d\n&quot;</span>, a[i]), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="keyword">int</span> val, next;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;val, &amp;next);</span><br><span class="line">            <span class="keyword">if</span> (val &lt; x &amp;&amp; val &gt; ans) p = a[i], ans = val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="number">-1</span> &amp;&amp; ans &lt; x) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d\n&quot;</span>, p), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="keyword">int</span> val, next;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;val, &amp;next);</span><br><span class="line">            ans = val;</span><br><span class="line">            p = next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ans &lt; x) ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;! %d&quot;</span>, ans), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="UOJ206-APIO2016-Gap"><a href="#UOJ206-APIO2016-Gap" class="headerlink" title="UOJ206 [APIO2016]Gap"></a>UOJ206 [APIO2016]Gap</h1><p>分两个子任务讨论：</p>
<ol>
<li><p>查询次数限制。</p>
<p>我们考虑第一次查询。因为我们一开始不知道任何数，所以我们需要询问范围 $[1, 10 ^ {18}]$，获得最大最小值。</p>
<p>由于查询次数限制刚好为 $\frac{N + 1}{2}$，所以考虑怎么每一次都能获取之前没有获取过的值，这样能大概在次数范围内获取序列内的所有数。方法也很简单：每次查询 $[s, t]$ 后，设获得的值为 $mn, mx$，则下一次查询 $[mn + 1, mx - 1]$。</p>
</li>
<li><p>询问区间大小限制。</p>
<p>由于题目要求询问区间内的数的数量之和不能超过 $3N$，所以考虑最小化询问区间。上面的方法不再可用，因为其询问区间内的数数量之和规模为 $O(N ^ 2)$。我们可以考虑二分值域，但这种方法并不可靠，最坏可能会被卡到 $O(N ^ 2)$。所以我们需要更有效的划分值域的方法，避免查询区间内的点重复查询，浪费机会。</p>
<p>考虑到答案不会小于 $\lfloor\frac{a_n - a_1}{N - 1}\rfloor$，所以我们可以考虑按这个值划分值域，设 $i$ 初始为 0，$ans$ 初始为上述值，每次询问 $[i, i + ans]$ 并且更新 $ans$，之后再以 $ans$ 为步长让 $i$ 自增。</p>
<p>不过这种方法也不能很好地适用于子任务 1，因为最坏可能很多询问的值域内一个数都没有。</p>
</li>
</ol>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;gap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">findGap</span><span class="params">(<span class="keyword">int</span> T, <span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span> <span class="keyword">long</span> a[<span class="number">100005</span>] = &#123;&#125;, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> s = <span class="number">0</span>, t = <span class="number">1e18</span>, s1, t1;</span><br><span class="line">    <span class="keyword">if</span> (T == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">1</span>, r = N;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            MinMax(s, t, &amp;s1, &amp;t1);</span><br><span class="line">            a[l++] = s1, a[r--] = t1;</span><br><span class="line">            s = s1 + <span class="number">1</span>, t = t1 - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= N; i++)</span><br><span class="line">            ans = <span class="built_in">std</span>::max(ans, a[i] - a[i - <span class="number">1</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (T == <span class="number">2</span>) &#123;</span><br><span class="line">        MinMax(s, t, &amp;s1, &amp;t1);</span><br><span class="line">        ans = (t1 - s1) / (N - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> l = s1 + <span class="number">1</span>, r = t1, last = s1;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">long</span> <span class="keyword">long</span> i = l; i &lt;= r;) &#123;</span><br><span class="line">            MinMax(i, i + ans, &amp;s1, &amp;t1);</span><br><span class="line">            i += ans + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (s1 != <span class="number">-1</span>) ans = <span class="built_in">std</span>::max(ans, s1 - last), last = t1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="CF1088D-Ehab-and-another-another-xor-problem"><a href="#CF1088D-Ehab-and-another-another-xor-problem" class="headerlink" title="CF1088D Ehab and another another xor problem"></a>CF1088D Ehab and another another xor problem</h1><p>题目允许的交互只有比较异或指定数后的大小，所以考虑每次比较 $a, b$ 的当前第 $k$ 位，在计算出第 $k$ 位后再计算第 $k - 1$ 位。之后比较时可以异或已知的第 $k$ 位及以上的部分，从而保证当前比较大小只比较 $k - 1$ 位及以下的部分。</p>
<p>因为有 62 次机会，所以考虑每次通过两次查询计算出当前位。</p>
<p>考虑计算到第 $k$ 位时的情况。首先是前 $k$ 位的比较大小情况（可以通过保留 $k + 1$ 位时查询获得的信息得到），然后尝试分类讨论，根据不同情况分别决定两数在当前查询时是否变换第 $k$ 位。一共有 4 种情况，分类讨论后可以发现将两数的当前位确定为其中任一种情况都需要且仅需要两次查询。</p>
<p>简单来说，在只考虑 $k$ 位及以下的部分时，如果两数都异或第 $k$ 位和都不异或第 $k$ 位的情况相同，则两数的第 $k$ 位相同，此时可以将 $a$ 异或第 $k$ 位再比较，如果此时结果为 -1 则两数第 $k$ 位都为 1，否则都为 0；如果两数都异或第 $k$ 位和都不异或第 $k$ 位的情况不同，则说明两数第 $k$ 位不同。则可以通过判断前 $k$ 位大小，知道是 $a$ 的第 $k$ 为 1 还是 $b$ 的第 $k$ 位为 1。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> a, b;</span><br><span class="line"><span class="keyword">int</span> flag;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;? 0 0\n&quot;</span>), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;flag);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">29</span>; k &gt;= <span class="number">0</span>; k--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> d, d2;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, a ^ (<span class="number">1</span> &lt;&lt; k), b ^ (<span class="number">1</span> &lt;&lt; k)), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, a ^ (<span class="number">1</span> &lt;&lt; k), b), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d2);</span><br><span class="line">            <span class="keyword">if</span> (flag != d) a ^= <span class="number">1</span> &lt;&lt; k, flag = d2;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (flag == d &amp;&amp; d2 == <span class="number">-1</span>) a ^= <span class="number">1</span> &lt;&lt; k, b ^= <span class="number">1</span> &lt;&lt; k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> d, d2;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, a ^ (<span class="number">1</span> &lt;&lt; k), b ^ (<span class="number">1</span> &lt;&lt; k)), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;? %d %d\n&quot;</span>, a ^ (<span class="number">1</span> &lt;&lt; k), b), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;d2);</span><br><span class="line">            <span class="keyword">if</span> (flag != d) b ^= <span class="number">1</span> &lt;&lt; k, flag = d2;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (flag == d &amp;&amp; d2 == <span class="number">-1</span>) a ^= <span class="number">1</span> &lt;&lt; k, b ^= <span class="number">1</span> &lt;&lt; k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;! %d %d&quot;</span>, a, b), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="CF750F-New-Year-and-Finding-Roots"><a href="#CF750F-New-Year-and-Finding-Roots" class="headerlink" title="CF750F New Year and Finding Roots"></a>CF750F New Year and Finding Roots</h1><p>看到 $h \le 7$，询问次数 $\le 16$ 的严格要求，我们需要非常严格地最大化利用访问获得的信息。</p>
<p>$h \le 4$ 时可以直接暴力枚举。然而 $h &gt; 4$ 时需要很高效的遍历算法。</p>
<p>随机撒点不是好方法，因为随机撒点无法确定自己是否足够接近根节点了，并且单纯随机撒点，至少有一次碰到根节点的概率为 $1 - (\frac{2 ^ h - 2}{2 ^ h - 1})$，即使排除重复撒点的情况后，碰到根节点的概率仍然非常小。</p>
<p>由于 $1 \le k \le 3$，并且我们并不知道哪一边更接近根节点，所以我们考虑最坏的情况，即如果 $k = 3$ 时，前两次我们的遍历方向都是远离根节点的，第三次遍历方向是接近根节点的。所以我们必须往三个方向都遍历。</p>
<p>考虑 bfs 和 dfs 两种遍历方法。由于 bfs 搜索树可能很大，所以我们优先考虑 dfs。当然，如果我们知道当前的深度，并且当前深度小到深度范围内的搜索树规模小于等于剩余次数，我们就可以直接 bfs。</p>
<p>知道当前节点的深度，以及当前遍历的方向会获得很大优势。然而知道当前在往根节点还是在往叶子节点遍历是非常困难的事情。如果使用 dfs，只有当遍历到根节点（$k = 2$）或者叶子节点（$k = 1$）时才知道当前方向。所以我们需要尽可能知道当前节点深度，并且不能采用类似迭代加深搜索的方法，遍历中途停下来。</p>
<p>考虑随机一个初始节点，从初始节点出发可能碰到上面的最坏情况。</p>
<p>如果 $k = 1$，我们就可以直接知道当前节点的深度。</p>
<p>如果 $k = 2$，那当前节点即根节点。</p>
<p>如果 $k = 3$，我们直接考虑往三个方向 dfs。考虑到其中两个方向是直接往叶子节点的方向，遍历路径长度相同；另一个方向是往根节点的方向，不过可能中途不小心往叶子节点的方向走了，遍历路径长度会较大。此时我们就可以计算出当前节点的深度。</p>
<p>当 $k = 1$ 或者 $k = 3$ 时，我们需要考虑较长的遍历路径。我们可以知道路径上深度最小的点（必定比初始节点深度小）。如果我们为访问过的节点打标记，不再遍历，此时从该节点开始就只有一条遍历路径。虽然这条路径可能还是会走向叶子节点，但是这条路径上同样必然存在深度比起点小的节点，我们就可以从这个节点开始继续重复上面的步骤。</p>
<p>当然，我们考虑 $h = 7$ 的最坏情况时（每次只往根节点走一步，就直接往叶子节点走），会发现如果只 dfs，最坏需要 $\frac{(1 + 7) \times 7}{2} = 28$ 次询问。不过我们已经知道初始节点的深度，所以我们可以算出所有已遍历节点的深度，并且根据我们开始时对 bfs 的讨论，判断是否可以从深度最小的点直接 bfs。</p>
<p>这时，我们可以算出最坏需要 17 次。所以我们考虑从搜索树上去掉一个节点（根据 dfs 只能盲目遍历的性质，我们考虑 bfs）：即当进行深度为 $k$ 的 bfs 时，搜索树节点最坏有 $2 ^ k - 1$ 个，可能需要 $2 ^ k - 1$ 次询问才能确定哪个节点的邻居恰有 2 个。不过我们如果已经对其中 $2 ^ k - 2$ 个节点询问后，可以知道最后一个节点肯定是根节点。</p>
<p>此时最坏情况下的最优解为：$h = 7$ 时，从叶子节点 dfs，每次都是只往根节点走一步，就直接往叶子节点走，询问 10 次后，当前已知最小深度的节点深度为 4，由于已知其父亲，直接从其父亲开始 bfs（搜索树深度为 3，节点数为 $2 ^ 3 - 1 = 7$）。在 bfs 时询问了 $2 ^ 3 - 2 = 6$ 次后，确定 bfs 搜索树上最后一个节点为根节点。</p>
<p>此时我们的算法可以刚好卡到最坏 16 次。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">256</span> + <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> T, h, chance;</span><br><span class="line"><span class="keyword">bool</span> ok;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; to[N], path;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (to[x].empty()) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;? %d\n&quot;</span>, x), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="keyword">int</span> k, t;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;k);</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t);</span><br><span class="line">            to[x].push_back(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;! %d\n&quot;</span>, x), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="keyword">return</span> ok = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        chance--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (to[x].empty()) path.push_back(x);</span><br><span class="line">    <span class="keyword">if</span> (read(x)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : to[x])</span><br><span class="line">        <span class="keyword">if</span> (to[i].empty()) <span class="keyword">return</span> dfs(i);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">int</span> s, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : to[s])</span><br><span class="line">        <span class="keyword">if</span> (to[i].empty()) q.push(i);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; k; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span> (read(x)) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j : to[x])</span><br><span class="line">            <span class="keyword">if</span> (to[j].empty()) q.push(j);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; k; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span> (read(x)) <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;! %d\n&quot;</span>, q.front()), fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T); T--; ) &#123;</span><br><span class="line">        ok = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) to[i].clear();</span><br><span class="line">        chance = <span class="number">16</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;h);</span><br><span class="line">        <span class="keyword">if</span> (h == <span class="number">0</span>) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; long_path;</span><br><span class="line">        <span class="keyword">if</span> (read(<span class="number">1</span>)) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">int</span> root, dep;</span><br><span class="line">        <span class="keyword">if</span> (to[<span class="number">1</span>].size() == <span class="number">1</span>) root = <span class="number">1</span>, dep = h;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i : to[<span class="number">1</span>]) &#123;</span><br><span class="line">                path.clear();</span><br><span class="line">                <span class="keyword">if</span> (dfs(i)) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> (path.size() &gt; long_path.size()) swap(path, long_path);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ok) <span class="keyword">continue</span>;</span><br><span class="line">            dep = h - (path.size() + long_path.size()) / <span class="number">2</span>;</span><br><span class="line">            root = long_path.at((long_path.size() - (h - dep)) - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ((<span class="number">1</span> &lt;&lt; (dep - <span class="number">1</span>)) - <span class="number">2</span> &gt; chance) &#123;</span><br><span class="line">            path.clear();</span><br><span class="line">            <span class="keyword">if</span> (dfs(root)) <span class="keyword">break</span>;</span><br><span class="line">            dep = h - (h - dep + path.size()) / <span class="number">2</span>;</span><br><span class="line">            root = path.at((path.size() - (h - dep)) - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ok == <span class="literal">false</span>) bfs(root, <span class="number">1</span> &lt;&lt; (dep - <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>

<h1 id="UVA12731-太空站之谜-Mysterious-Space-Station"><a href="#UVA12731-太空站之谜-Mysterious-Space-Station" class="headerlink" title="UVA12731 太空站之谜 Mysterious Space Station"></a>UVA12731 太空站之谜 Mysterious Space Station</h1><p>本博客开头提到的神仙题。本题刘汝佳的标程长达 8k（作为对比，P5473 [NOI2019]I 君的探险 是 NOI D2T3，标程也仅 2.5k），充分体现了刘汝佳的优秀的算法思维和代码编写能力（包括清晰的函数和程序结构，自顶向下、逐步求精的结构化编程，宏定义优化可读性，变量复用，代码的宏观分析和维护，并且从一开始就保证逻辑清晰，尽量避免 BUG）。下面放上刘汝佳的标程（为 UOJ 同题，去掉了多组数据后的标程）：</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Modified by Rujia Liu from station2.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Wall 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Unknown 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Nothing 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Gate 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MatchGate 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> dire[<span class="number">8</span>][<span class="number">2</span>] = &#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">-1</span>&#125;,&#123;<span class="number">-1</span>,<span class="number">-1</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">char</span> direchar[<span class="number">5</span>] = <span class="string">&quot;ESWN&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, gatenum;</span><br><span class="line"><span class="keyword">int</span> data[<span class="number">20</span>][<span class="number">20</span>]; <span class="comment">/* the status of the fields */</span></span><br><span class="line"><span class="keyword">int</span> op[<span class="number">20</span>][<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Round[<span class="number">20</span>][<span class="number">20</span>][<span class="number">400</span>];</span><br><span class="line"><span class="keyword">int</span> Info[<span class="number">20</span>][<span class="number">20</span>][<span class="number">400</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> nowx, nowy; <span class="comment">/* (nowx, nowy) is the present position of the robot */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tfa</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> x, y, d, leng;</span><br><span class="line">&#125; fa[<span class="number">20</span>][<span class="number">20</span>], bakfa[<span class="number">20</span>][<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tqueue</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> x, y;</span><br><span class="line">&#125; <span class="built_in">queue</span>[<span class="number">400</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> way[<span class="number">400</span>];</span><br><span class="line"><span class="keyword">int</span> backway[<span class="number">400</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MoveRobot</span><span class="params">(<span class="keyword">char</span> Direction)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;MoveRobot %c\n&quot;</span>, Direction);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">int</span> ret;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;ret);</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Answer</span><span class="params">(<span class="keyword">int</span> pos1, <span class="keyword">int</span> pos2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Answer %d %d\n&quot;</span>, pos1, pos2);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Readin</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, j;</span><br><span class="line">  <span class="keyword">char</span> ch, row[<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;n, &amp;m, &amp;gatenum) != <span class="number">3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(!n) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, row);</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">      ch = row[j];</span><br><span class="line">      <span class="keyword">if</span> (ch == <span class="string">&#x27;S&#x27;</span>) nowx = i, nowy = j;</span><br><span class="line">      <span class="keyword">if</span> (ch == <span class="string">&#x27;*&#x27;</span>) data[i][j] = Wall;</span><br><span class="line">      <span class="keyword">else</span> data[i][j] = Unknown;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FillAround</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> <span class="comment">/* since (x,y) is a Gate or a Wall, the fields */</span></span></span><br><span class="line"><span class="function">                              <span class="comment">/* around it should be Nothing */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, x1, y1;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    x1 = x + dire[i][<span class="number">0</span>];</span><br><span class="line">    y1 = y + dire[i][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt;= <span class="number">0</span> &amp;&amp; y1 &gt;= <span class="number">0</span> &amp;&amp; x1 &lt; n &amp;&amp; y1 &lt; m &amp;&amp; data[x1][y1] == Unknown)</span><br><span class="line">      data[x1][y1] = Nothing;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">NearWall</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, x1, y1;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (data[x][y] != Nothing) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    x1 = x + dire[i][<span class="number">0</span>];</span><br><span class="line">    y1 = y + dire[i][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt;= <span class="number">0</span> &amp;&amp; y1 &gt;= <span class="number">0</span> &amp;&amp; x1 &lt; n &amp;&amp; y1 &lt; m &amp;&amp; data[x1][y1] == Wall)</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GoRound</span><span class="params">(<span class="keyword">int</span> sx, <span class="keyword">int</span> sy, <span class="keyword">int</span> dir)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x, y, x1, y1, i, j, h, max;</span><br><span class="line">  <span class="keyword">int</span> ok[<span class="number">20</span>][<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(ok, <span class="number">0</span>, <span class="keyword">sizeof</span>(ok));</span><br><span class="line">  Round[sx][sy][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  x = sx; y = sy;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span> == <span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    dir = (dir + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">    x1 = x + dire[dir][<span class="number">0</span>];</span><br><span class="line">    y1 = y + dire[dir][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data[x1][y1] == Wall)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (ok[x1][y1] == <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        Round[sx][sy][<span class="number">0</span>]++;</span><br><span class="line">        Round[sx][sy][Round[sx][sy][<span class="number">0</span>]] = dir;</span><br><span class="line">        Info[sx][sy][Round[sx][sy][<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">        ok[x1][y1] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (ok[x1][y1] == <span class="number">0</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        Round[sx][sy][<span class="number">0</span>]++;</span><br><span class="line">        Round[sx][sy][Round[sx][sy][<span class="number">0</span>]] = dir;</span><br><span class="line">        Info[sx][sy][Round[sx][sy][<span class="number">0</span>]] = <span class="number">1</span>;</span><br><span class="line">        ok[x1][y1] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      x = x1; y = y1;</span><br><span class="line">      dir = (dir + <span class="number">2</span>) % <span class="number">4</span>;</span><br><span class="line">      <span class="keyword">if</span> (x == sx &amp;&amp; y == sy) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  max = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    <span class="keyword">if</span> ((i != sx || j != sy) &amp;&amp; NearWall(i,j) != <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      x = i; y = j;</span><br><span class="line">      <span class="keyword">for</span> (h = <span class="number">1</span>; h &lt;= Round[sx][sy][<span class="number">0</span>]; h++)</span><br><span class="line">      &#123;</span><br><span class="line">        x1 = x + dire[Round[sx][sy][h]][<span class="number">0</span>];</span><br><span class="line">        y1 = y + dire[Round[sx][sy][h]][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (data[x1][y1] == Wall &amp;&amp; Info[sx][sy][h] == <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (data[x1][y1] == Nothing &amp;&amp; Info[sx][sy][h] == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          x = x1; y = y1;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (h &gt; max) max = h;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  Round[sx][sy][<span class="number">0</span>] = max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, j, h;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  memset(Round, 0, sizeof(Round));</span></span><br><span class="line"><span class="comment">  memset(Info, 0, sizeof(Info));</span></span><br><span class="line"><span class="comment">  memset(op, 0, sizeof(op));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  memset(way, 0, sizeof(way));</span></span><br><span class="line"><span class="comment">  memset(backway, 0, sizeof(backway));</span></span><br><span class="line"><span class="comment">  memset(queue, 0, sizeof(queue));</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    <span class="keyword">if</span> (data[i][j] == Wall) FillAround(i,j);</span><br><span class="line"></span><br><span class="line">  h = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    <span class="keyword">if</span> (data[i][j] != Wall)</span><br><span class="line">    &#123;</span><br><span class="line">      h++;</span><br><span class="line">      op[i][j] = h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    <span class="keyword">if</span> (data[i][j] == Nothing)</span><br><span class="line">    &#123;</span><br><span class="line">      h = NearWall(i,j);</span><br><span class="line">      <span class="keyword">if</span> (h != <span class="number">-1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> (h &lt; <span class="number">4</span>)</span><br><span class="line">          GoRound(i,j,h);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          GoRound(i,j,(h+<span class="number">3</span>)%<span class="number">4</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> nowx, <span class="keyword">int</span> nowy)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> head, tail, x, y, x1, y1, i;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(fa, <span class="number">-1</span>, <span class="keyword">sizeof</span>(fa));</span><br><span class="line">  fa[nowx][nowy].d = <span class="number">0</span>; fa[nowx][nowy].leng = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  head = tail = <span class="number">0</span>; <span class="built_in">queue</span>[head].x = nowx; <span class="built_in">queue</span>[head].y = nowy;</span><br><span class="line">  <span class="keyword">while</span> (head &lt;= tail)</span><br><span class="line">  &#123;</span><br><span class="line">    x = <span class="built_in">queue</span>[head].x; y = <span class="built_in">queue</span>[head].y;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">      x1 = x + dire[i][<span class="number">0</span>];</span><br><span class="line">      y1 = y + dire[i][<span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> (x1 &gt;= <span class="number">0</span> &amp;&amp; y1 &gt;= <span class="number">0</span> &amp;&amp; x1 &lt; n &amp;&amp; y1 &lt; m &amp;&amp;</span><br><span class="line">            data[x1][y1] == Nothing &amp;&amp; fa[x1][y1].d == <span class="number">-1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        tail++;</span><br><span class="line">        <span class="built_in">queue</span>[tail].x = x1;</span><br><span class="line">        <span class="built_in">queue</span>[tail].y = y1;</span><br><span class="line"></span><br><span class="line">        fa[x1][y1].x = x;</span><br><span class="line">        fa[x1][y1].y = y;</span><br><span class="line">        fa[x1][y1].d = i;</span><br><span class="line">        fa[x1][y1].leng = fa[x][y].leng + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    head++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MoveTo</span><span class="params">(<span class="keyword">int</span> aimx, <span class="keyword">int</span> aimy)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> x, y, x1, y1, i;</span><br><span class="line"></span><br><span class="line">  BFS(nowx, nowy);</span><br><span class="line"></span><br><span class="line">  x = aimx; y = aimy;</span><br><span class="line">  way[<span class="number">0</span>] = fa[x][y].leng; i = way[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">while</span> (x != nowx || y != nowy)</span><br><span class="line">  &#123;</span><br><span class="line">    way[i] = fa[x][y].d;</span><br><span class="line">    x1 = fa[x][y].x;</span><br><span class="line">    y1 = fa[x][y].y;</span><br><span class="line">    x = x1; y = y1; i--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= way[<span class="number">0</span>]; i++)</span><br><span class="line">    MoveRobot(direchar[way[i]]);</span><br><span class="line">  nowx = aimx; nowy = aimy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Value</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> val;</span><br><span class="line">  val = <span class="number">0</span>;</span><br><span class="line">  val += bakfa[x][y].leng;</span><br><span class="line">  val += Round[x][y][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> -val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FindWayToWall</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, j, x, y, x1, y1;</span><br><span class="line"></span><br><span class="line">  BFS(nowx, nowy);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memcpy</span>(bakfa, fa, <span class="keyword">sizeof</span>(fa));</span><br><span class="line"></span><br><span class="line">  x = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    <span class="keyword">if</span> (NearWall(i,j) != <span class="number">-1</span> &amp;&amp; bakfa[i][j].d != <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (x == <span class="number">-1</span>) x = i, y = j;</span><br><span class="line">      <span class="keyword">if</span> (Value(i,j) &gt; Value(x,y))</span><br><span class="line">        x = i, y = j;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  way[<span class="number">0</span>] = bakfa[x][y].leng; i = way[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">while</span> (x != nowx || y != nowy)</span><br><span class="line">  &#123;</span><br><span class="line">    way[i] = bakfa[x][y].d;</span><br><span class="line">    x1 = bakfa[x][y].x;</span><br><span class="line">    y1 = bakfa[x][y].y;</span><br><span class="line">    x = x1; y = y1; i--;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MoveBack</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = backway[<span class="number">0</span>]; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">    MoveRobot(direchar[(backway[i] + <span class="number">2</span>) % <span class="number">4</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Test</span><span class="params">(<span class="keyword">int</span> stdx, <span class="keyword">int</span> stdy)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, j, sx, sy;</span><br><span class="line"></span><br><span class="line">  backway[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  nowx = stdx; nowy = stdy;</span><br><span class="line"></span><br><span class="line">  FindWayToWall();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= way[<span class="number">0</span>]; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    j = MoveRobot(direchar[way[i]]);</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      backway[<span class="number">0</span>]++;</span><br><span class="line">      backway[backway[<span class="number">0</span>]] = way[i];</span><br><span class="line">      nowx = nowx + dire[way[i]][<span class="number">0</span>];</span><br><span class="line">      nowy = nowy + dire[way[i]][<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      MoveBack();</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  sx = nowx; sy = nowy;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= Round[sx][sy][<span class="number">0</span>]; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    j = MoveRobot(direchar[ Round[sx][sy][i] ]);</span><br><span class="line">    <span class="keyword">if</span> (j == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      backway[<span class="number">0</span>]++;</span><br><span class="line">      backway[backway[<span class="number">0</span>]] = Round[sx][sy][i];</span><br><span class="line">      nowx = nowx + dire[Round[sx][sy][i]][<span class="number">0</span>];</span><br><span class="line">      nowy = nowy + dire[Round[sx][sy][i]][<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (j != Info[sx][sy][i])</span><br><span class="line">    &#123;</span><br><span class="line">      MoveBack();</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Judge</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, j, totgate;</span><br><span class="line"></span><br><span class="line">  totgate = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = n<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">    <span class="keyword">for</span> (j = m<span class="number">-1</span>; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">    <span class="keyword">if</span> (data[i][j] == Unknown)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (totgate == gatenum*<span class="number">2</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        data[i][j] = Nothing;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      MoveTo(i,j+<span class="number">1</span>);</span><br><span class="line">      MoveRobot(<span class="string">&#x27;W&#x27;</span>); MoveRobot(<span class="string">&#x27;S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (Test(i+<span class="number">1</span>,j) == <span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">/* (i,j) is Nothing */</span></span><br><span class="line">        data[i][j] = Nothing;</span><br><span class="line">      &#125; <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">/* (i,j) is a Gate */</span></span><br><span class="line">        totgate++;</span><br><span class="line">        data[i][j] = Gate;</span><br><span class="line">        FillAround(i,j);</span><br><span class="line"></span><br><span class="line">        MoveRobot(<span class="string">&#x27;N&#x27;</span>); MoveRobot(<span class="string">&#x27;E&#x27;</span>);</span><br><span class="line">        nowx = i; nowy = j+<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Match</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i, j, i1, j1, i2, j2, totmatch;</span><br><span class="line"></span><br><span class="line">  totmatch = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    <span class="keyword">if</span> (data[i][j] == Gate)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (totmatch + <span class="number">1</span> == gatenum)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">for</span> (i1 = <span class="number">0</span>; i1 &lt; n; i1++)</span><br><span class="line">          <span class="keyword">for</span> (j1 = <span class="number">0</span>; j1 &lt; m; j1++)</span><br><span class="line">          <span class="keyword">if</span> (data[i1][j1] == Gate &amp;&amp; (i1 != i || j1 != j)) &#123;</span><br><span class="line">            Answer(op[i][j], op[i1][j1]);</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// don&#x27;t continue MoveRobot after answering everything!</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      MoveTo(i<span class="number">-1</span>,j);</span><br><span class="line">      MoveRobot(<span class="string">&#x27;S&#x27;</span>);</span><br><span class="line"></span><br><span class="line">      i2 = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">for</span> (i1 = <span class="number">0</span>; i1 &lt; n; i1++)</span><br><span class="line">        <span class="keyword">for</span> (j1 = <span class="number">0</span>; j1 &lt; m; j1++)</span><br><span class="line">        <span class="keyword">if</span> (i2 == <span class="number">-1</span> &amp;&amp; data[i1][j1] == Gate &amp;&amp; (i1 != i || j1 != j))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> (Test(i1+<span class="number">1</span>,j1) == <span class="number">1</span>)</span><br><span class="line">          &#123;</span><br><span class="line">            i2 = i1;</span><br><span class="line">            j2 = j1;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      Answer(op[i][j], op[i2][j2]);</span><br><span class="line">      data[i][j] = MatchGate;</span><br><span class="line">      data[i2][j2] = MatchGate;</span><br><span class="line">      totmatch++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Readin();</span><br><span class="line">  Initialize();</span><br><span class="line">  Judge();</span><br><span class="line">  Match();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>

<p>刘汝佳的《算法竞赛入门经典》P444 的分析有非常详细的解释、举例与说明，这里仅简单介绍。</p>
<p><del>为什么原题没有 P444 的背景啊</del></p>
<p>由于唯一的反馈是移动时是否撞墙，所以我们应该考虑在机器人不走丢的情况下，尽量接近墙边走路，这样有几个好处：</p>
<ul>
<li>靠近墙边走路时，很容易知道自己会不会撞墙，获取到尽量多的信息。</li>
<li>墙边都是不会出现传送门的格子，可以避免机器人走丢。</li>
</ul>
<p>所以，我们如果已知机器人可能在墙边的某个位置，要确定机器人是不是真的在这个位置，就可以通过“单手扶墙法”确定自己是不是真的在这个位置。根据拓扑学原理，在两边都是墙的迷宫中，如果从入口进入，并且总是用一只手扶着同一边墙，就可以保证找到出口。由于本题中的墙是闭合的，所以只需要沿着墙边的道路走，就可以保证可以回到原点而不会撞墙。另外，由于墙边的道路是地图上的最大闭合回路，所以实际代码中并不需要特意撞墙以保证机器人在墙边，可以使用标记在地图中标明墙边道路。而且一旦撞了墙，就需要赶快沿着原路返回，可以在避免机器人走丢的同时减少步数。</p>
<p>由上，可以推断出确定机器人是否在特定格子的试错法：将机器人在不走到未知格子或已知传送门的情况下走到墙边的道路上，然后绕着墙边道路走一圈。这个过程中如果没有撞墙，就可以确定机器人确实是在特定格子。</p>
<p>我们可以采用上面的方法，一开始标出图中所有未知格子，然后从上到下，从左到右依次判断每个未知格子是否是传送门。可以先走到未知格子上方，然后向下、向左走。再用上面的方法判断机器人是不是在未知格子的左侧。如果不是，说明机器人不在应该在的位置，即未知格子是传送门。</p>
<p>找出未知格子后就需要判断 2k 个未知格子的配对关系，不过《算法竞赛入门经典》中给出了“不难发现”，“细节留给读者思考”的标准答案。实际方法也很简答：只需要暴力配对就可以了。由于 $k \le 5$，所以最多只需要 $9 + 7 + 5 + 3$ 次试错法。作为对比，判断图中全部未知格子的情况最多需要 $121 - 40$ 次试错法。</p>
<p>然后为了对比刘汝佳的<del>纸老虎</del>标程，我使用了 4k 代码完成本题。<del>应该和刘汝佳代码质量差不多。</del></p>
<p><del>另外刘汝佳代码大括号换行和二空格缩进的水分很多，格式化之后会短很多。不过刘汝佳的 400 行标程真的没法缩短了。并且刘汝佳还有用数组的第 0 个位置表示数组长度之类的陋习，所以代码看着还是有点难受，只能把握大体思路。</del></p>
<p><del>为什么 Ynoi 成为了广为人知的毒瘤题集合？因为 Rujia’s Present 根本没人做。</del></p>
<p>由于目前我的代码只能通过 UOJ 的镜像题：<a target="_blank" rel="noopener" href="http://uoj.ac/problem/247">#247. 【Rujia Liu’s Present 7】Mysterious Space Station</a>，而无法通过 UVa 原题。修改了 UOJ 上刘汝佳的标程后还是无法通过，并且我无法联系到刘汝佳。所以下面的代码以 UOJ 为准。</p>
<p>不过刘汝佳的标程质量还是比下面这份代码质量高很多的，可以在 UOJ 上查看到<a target="_blank" rel="noopener" href="http://uoj.ac/submission/105789">通过了 UOJ 镜像题的标程</a>。同一份数据下，标程使用的移动次数非常少。</p>
<div><div class="fold_hider"><div class="close hider_title">代码：</div></div><div class="fold">
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="comment">// #include&quot;warning.h&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Wall 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Unknown 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Space 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Gate 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Path 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dir[<span class="number">8</span>][<span class="number">2</span>] = &#123;&#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">1</span>&#125;, &#123;<span class="number">1</span>, <span class="number">-1</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> dirs[<span class="number">5</span>] = <span class="string">&quot;ESWN&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, k;</span><br><span class="line"><span class="keyword">int</span> a[N][N], id[N][N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line">    point(<span class="keyword">int</span> x = <span class="number">0</span>, <span class="keyword">int</span> y = <span class="number">0</span>): x(x), y(y) &#123;&#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> point&amp; tmp) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x == tmp.x &amp;&amp; y == tmp.y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> <span class="keyword">operator</span> != (<span class="keyword">const</span> point&amp; tmp) <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !(*<span class="keyword">this</span> == tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">point <span class="title">side</span><span class="params">(<span class="keyword">int</span> d)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> point(x + dir[d][<span class="number">0</span>], y + dir[d][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a[x + dir[d][<span class="number">0</span>]][y + dir[d][<span class="number">1</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ::id[x][y];</span><br><span class="line">    &#125;</span><br><span class="line">&#125; start;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">pair</span>&lt;point, <span class="keyword">int</span>&gt;&gt; path;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">pair</span>&lt;point, point&gt; ans[N];</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">pair</span>&lt;point, <span class="keyword">bool</span>&gt; vis[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">walk</span><span class="params">(<span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;MoveRobot %c\n&quot;</span>, dirs[d]);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;ret);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">walk</span><span class="params">(<span class="keyword">int</span> d, <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;&amp; st)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (walk(d)) &#123;</span><br><span class="line">        st.push(d);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;k) != <span class="number">3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="keyword">sizeof</span>(a));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; c;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">&#x27;S&#x27;</span>) start = point(i, j);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="string">&#x27;*&#x27;</span>) a[i][j] = Wall;</span><br><span class="line">            <span class="keyword">else</span> a[i][j] = Unknown;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">answer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Answer %d %d\n&quot;</span>, ans[i].first.id(), ans[i].second.id());</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 单手扶墙法，因为靠墙的 Path 是极大闭合环，所以只需要在沿着 Path 走的过程中没有碰到障碍就可以了</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wall_follower_init</span><span class="params">(point x, <span class="keyword">int</span> last, <span class="keyword">int</span> wallside, point s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == s &amp;&amp; !path.empty()) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x.check(wallside) == Path) &#123;</span><br><span class="line">        path.push_back(<span class="built_in">std</span>::<span class="built_in">make_pair</span>(x, wallside));</span><br><span class="line">        wall_follower_init(x.side(wallside), wallside, last ^ <span class="number">2</span>, s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (x.check(last) == Wall) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            <span class="keyword">if</span> (i != (last ^ <span class="number">2</span>) &amp;&amp; x.check(i) != Wall) &#123;</span><br><span class="line">                path.push_back(<span class="built_in">std</span>::<span class="built_in">make_pair</span>(x, i));</span><br><span class="line">                wall_follower_init(x.side(i), i, last, s);</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        path.push_back(<span class="built_in">std</span>::<span class="built_in">make_pair</span>(x, last));</span><br><span class="line">        wall_follower_init(x.side(last), last, wallside, s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i][j] == Unknown) &#123;</span><br><span class="line">                id[i][j] = cnt++;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">8</span>; k++)</span><br><span class="line">                    <span class="keyword">if</span> (point(i, j).check(k) == Wall) &#123;</span><br><span class="line">                        a[i][j] = Path;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> id[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    path.clear();</span><br><span class="line">    <span class="keyword">int</span> wallside = <span class="number">0</span>, last = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        <span class="keyword">if</span> (start.check(i) == Wall) &#123;</span><br><span class="line">            wallside = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        <span class="keyword">if</span> (start.check(i) == Path &amp;&amp; i != (wallside ^ <span class="number">2</span>)) &#123;</span><br><span class="line">            last = i;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    wall_follower_init(start, last, wallside, start);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">undo</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;&amp; st)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!st.empty()) walk(st.top() ^ <span class="number">2</span>), st.pop();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">wall_follower</span><span class="params">(point x)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; st;</span><br><span class="line">    <span class="keyword">bool</span> ok = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; path.size() &amp;&amp; path[i].first != x) i++;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = i; ok &amp;&amp; j &lt; path.size(); j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (walk(path[j].second)) st.push(path[j].second);</span><br><span class="line">        <span class="keyword">else</span> ok = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; ok &amp;&amp; j &lt; i; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (walk(path[j].second)) st.push(path[j].second);</span><br><span class="line">        <span class="keyword">else</span> ok = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ok == <span class="literal">false</span>) undo(st);</span><br><span class="line">    <span class="keyword">return</span> ok;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 确定自己当前在 x，使用“摸着石头过河”的方法，只需要沿着可以避开障碍、未知格子和传送门的方向走到 Path 就行。</span></span><br><span class="line"><span class="comment">// 在找传送门和配对传送门时使用</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bfs</span><span class="params">(point s, point t, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> <span class="built_in">map</span>[N][N] = &#123;&#125;;</span><br><span class="line">    <span class="built_in">memset</span>(<span class="built_in">map</span>, <span class="number">-1</span>, <span class="keyword">sizeof</span>(<span class="built_in">map</span>));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">queue</span>&lt;point&gt; q;</span><br><span class="line">    <span class="built_in">map</span>[s.x][s.y] = <span class="number">4</span>;</span><br><span class="line">    q.push(s);</span><br><span class="line">    <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">        point x = q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span> (x == t) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            point y = x.side(i);</span><br><span class="line">            <span class="keyword">if</span> ((x.check(i) == Path || x.check(i) == Space) &amp;&amp; <span class="built_in">map</span>[y.x][y.y] == <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="built_in">map</span>[y.x][y.y] = i;</span><br><span class="line">                q.push(y);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (point x = t; x != s; x = x.side(<span class="built_in">map</span>[x.x][x.y] ^ <span class="number">2</span>)) &#123;</span><br><span class="line">        v.push_back(<span class="built_in">map</span>[x.x][x.y]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::reverse(v.begin(), v.end());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">move</span><span class="params">(point s, point t, <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;&amp; st)</span> </span>&#123; <span class="comment">// 在靠近传送门时使用</span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line">    v.clear();</span><br><span class="line">    bfs(s, t, v);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : v)</span><br><span class="line">        <span class="keyword">if</span> (walk(i, st) == <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">make_sure</span><span class="params">(point x, <span class="keyword">int</span> last)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (a[x.x][x.y] == Path) <span class="keyword">return</span> wall_follower(x);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">        <span class="keyword">if</span> ((x.check(i) == Path || x.check(i) == Space) &amp;&amp; i != (last ^ <span class="number">2</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!walk(i)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">bool</span> ret = make_sure(x.side(i), i);</span><br><span class="line">            walk(i ^ <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	bool ok = true;</span></span><br><span class="line"><span class="comment">	std::stack&lt;int&gt; st;</span></span><br><span class="line"><span class="comment">	if (!move(x, start, st) || !wall_follower(start)) ok = false;</span></span><br><span class="line"><span class="comment">	undo(st);</span></span><br><span class="line"><span class="comment">	return ok;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_gate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; st;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">            <span class="keyword">if</span> (cnt == k * <span class="number">2</span> &amp;&amp; a[i][j] == Unknown) a[i][j] = Space;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (a[i][j] == Unknown) &#123;</span><br><span class="line">                <span class="keyword">bool</span> ok = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (!move(start, point(i - <span class="number">1</span>, j), st)) ok = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!walk(<span class="number">1</span>, st)) ok = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!walk(<span class="number">2</span>, st)) ok = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (!make_sure(point(i, j - <span class="number">1</span>), <span class="number">-1</span>)) ok = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">if</span> (ok == <span class="literal">false</span>) &#123;</span><br><span class="line">                    vis[cnt++] = <span class="built_in">std</span>::<span class="built_in">make_pair</span>(point(i, j), <span class="literal">false</span>);</span><br><span class="line">                    a[i][j] = Gate;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">8</span>; k++) &#123;</span><br><span class="line">                        point y = point(i, j).side(k);</span><br><span class="line">                        <span class="keyword">if</span> (point(i, j).check(k) == Unknown) a[y.x][y.y] = Space;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> a[i][j] = Space;</span><br><span class="line">                undo(st);</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">make_gate_pair</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; st;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k * <span class="number">2</span>; i++) <span class="keyword">if</span> (vis[i].second == <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; vis[i].second == <span class="literal">false</span> &amp;&amp; j &lt; k * <span class="number">2</span>; j++) <span class="keyword">if</span> (j != i &amp;&amp; vis[j].second == <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">bool</span> ok = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (!move(start, vis[i].first.side(<span class="number">2</span>), st)) ok = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!walk(<span class="number">0</span>, st)) ok = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!make_sure(vis[j].first.side(<span class="number">0</span>), <span class="number">-1</span>)) ok = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (ok == <span class="literal">true</span>) &#123;</span><br><span class="line">                ans[cnt++] = <span class="built_in">std</span>::<span class="built_in">make_pair</span>(vis[i].first, vis[j].first);</span><br><span class="line">                vis[i].second = vis[j].second = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            undo(st);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (read()) &#123;</span><br><span class="line">        init();</span><br><span class="line">        find_gate();</span><br><span class="line">        make_gate_pair();</span><br><span class="line">        answer();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>

<h2 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h2><ul>
<li><a target="_blank" rel="noopener" href="https://onlinejudge.org/contests/328-9976a2e2/">刘汝佳的交互题专场比赛 Rujia Liu’s Present 7 质量非常高，推荐一做</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5473">P5473 [NOI2019]I 君的探险</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5208">P5208 [WC2019] I 君的商店</a></li>
<li><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF1355F">CF1355F Guess Divisors Count</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%AE%97%E6%B3%95%E6%80%9D%E6%83%B3/" rel="tag"># 算法思想</a>
              <a href="/tags/%E4%BA%A4%E4%BA%92%E9%A2%98/" rel="tag"># 交互题</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/OI%E7%AC%94%E8%AE%B0/%E7%BB%8F%E5%85%B8%E6%A0%91%E4%B8%8A%E9%97%AE%E9%A2%98/" rel="prev" title="经典树上问题">
                  <i class="fa fa-chevron-left"></i> 经典树上问题
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E6%8A%80%E6%9C%AF/%E7%88%AC%E8%99%AB%E5%AF%BC%E5%87%BA%E7%9F%A5%E4%B9%8E%E6%95%B0%E6%8D%AE/" rel="next" title="爬虫导出知乎数据">
                  爬虫导出知乎数据 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
  
  
  



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  















  








    <div class="pjax">
  

  
      <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.0/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
<script>
  $(document).ready(function () {
    $(document).on('click', '.fold_hider', function () {
      $('>.fold', this.parentNode).slideToggle();
      $('>:first', this).toggleClass('open');
    });
    //默认情况下折叠
    $("div.fold").css("display", "none");
  });
</script>
</html>
